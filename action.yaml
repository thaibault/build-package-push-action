name: Build package and push

inputs:
  debug:
    description: Sets "NODE_ENV" to "debug".
    required: false
    default: false
  type:
    description: Sets semantic version update type.
    default: patch
    type: choice
    options:
      - major
      - minor
      - patch

runs:
  using: composite

  steps:
    - uses: thaibault/install-npm-package-dependencies-action@main
      with:
        debug: ${{ inputs.debug }}

    - name: DEBUG
      # NOTE: Declare variable beforehand to avoid shadowing the nested shell's
      # exit code.
      run: ls -lha ${{ github.action_path }}
      shell: bash

    - name: Update package.json mentioned version.
      id: version
      # NOTE: Declare variable beforehand to avoid shadowing the nested shell's
      # exit code.
      run: |
        echo "new=$(bash ${{ github.action_path }}/determine-version.sh --format 'v${MAJOR}.${MINOR}.${PATCH}${CANDIDATE}' ${{inputs.type || 'patch'}})" \
        >> "$GITHUB_OUTPUT"
      shell: bash

    - name: print
      run: echo Output is '${{steps.version.outputs.new}}'
      shell: bash

    #- name: Create git tag for newly create package version.
      #run: git tag "${{outputs.NEW_VERSION}}"
      #shell: bash

    #- name: Update artefacts in git repository.
      #run: git commit --all --message 'Publish new version ${{outputs.NEW_VERSION}}.' && git push --tags && git push
      #shell: bash

    #- name: Publish newly created package.
      #env:
      #  NODE_ENV: ${{ contains(inputs.debug, 'true') && 'debug' || '' }}
      #run: yarn publish
